---
import Lightbox from "../components/Lightbox.astro";
import GalleryComponent from "../components/gallery/Gallery.astro";
import { fetchRandomPhotos } from "../lib/api";
import type { Photo } from "../lib/photos";

const USE_LOCAL_BACKEND = import.meta.env.PUBLIC_USE_LOCAL_BACKEND === "true";
const API_BASE_URL = USE_LOCAL_BACKEND
    ? "http://localhost:8080"
    : import.meta.env.PUBLIC_API_BASE_URL;
const IMAGE_BASE =
    import.meta.env.PUBLIC_IMAGE_BASE_URL ||
    "https://pub-0654db98da5e47f49578b68f4562e0fa.r2.dev/";
let photos: Photo[] = [];
let error: string | null = null;
try {
    photos = await fetchRandomPhotos(API_BASE_URL);
} catch (e: any) {
    error = e?.message || "Failed to load photos";
}
const baseURL = IMAGE_BASE;
---

<div>
    {
        error ? (
            <p class="text-red-400 font-medium">{error}</p>
        ) : (
            <>
                <GalleryComponent photos={photos} baseURL={baseURL} />
                <Lightbox photos={photos} baseURL={baseURL} />
            </>
        )
    }
</div>
