---
import type { Photo } from "../../lib/photos";
import { parseSizes, buildSrcset } from "../../lib/photos";

interface Props {
    photos: Photo[];
    baseURL: string;
}
const { photos, baseURL } = Astro.props;
---

<div class="w-full">
    <div class="columns-1 sm:columns-2 md:columns-3 lg:columns-4 gap-4">
        {
            photos.map((photo, index) => {
                let sizes: string[] = parseSizes(photo.availableSizes);
                return (
                    <picture class="break-inside-avoid mb-4 block rounded-lg overflow-hidden">
                        <source
                            type="image/webp"
                            srcset={buildSrcset(
                                baseURL,
                                photo.basename,
                                "webp",
                                sizes,
                            )}
                            sizes="(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                        />
                        <source
                            type="image/jpeg"
                            srcset={buildSrcset(
                                baseURL,
                                photo.basename,
                                "jpg",
                                sizes,
                            )}
                            sizes="(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"
                        />
                        <img
                            id={`gallery-img-${index}`}
                            data-loaded="false"
                            src={`${baseURL}${photo.basename}_lqip.jpg`}
                            alt={`Photo ${photo.basename}`}
                            loading="lazy"
                            decoding="async"
                            width={photo.width}
                            height={photo.height}
                            class="gallery-img w-full h-auto object-cover cursor-pointer"
                            onload="this.dataset.loaded='true'; this.classList.add('loaded');"
                            onclick={`openLightbox(${index})`}
                        />
                    </picture>
                );
            })
        }
    </div>
</div>

<style>
    .gallery-img {
        filter: blur(20px) brightness(1);
        transform: scale(1.1);
        transition:
            filter 0.3s ease-out,
            transform 0.1s ease-out;
    }
    .gallery-img.loaded {
        filter: blur(0) brightness(1);
    }
    .gallery-img.loaded:hover {
        filter: blur(0) brightness(1.1);
        transform: scale(1.15);
    }
</style>
