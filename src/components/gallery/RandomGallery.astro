---
import Gallery from "./Gallery.astro";
import Lightbox from "./Lightbox.astro";
import type { Photo } from "../../lib/photos";
import { fetchRandomPhotos } from "../../lib/api";

const API_BASE_URL =
    import.meta.env.PUBLIC_USE_LOCAL_BACKEND === "true"
        ? "http://localhost:8080"
        : import.meta.env.PUBLIC_API_BASE_URL;

let photos: Photo[] = [];
let error: string | null = null;
try {
    photos = await fetchRandomPhotos(API_BASE_URL);
} catch (e: any) {
    error = e?.message || "Failed to load photos";
}
const baseURL = import.meta.env.PUBLIC_IMAGE_BASE_URL;
---

<div>
    {
        error ? (
            <p class="text-red-400 font-medium">{error}</p>
        ) : (
            <>
                <Gallery photos={photos} baseURL={baseURL} />
                <Lightbox photos={photos} baseURL={baseURL} />
            </>
        )
    }
</div>
